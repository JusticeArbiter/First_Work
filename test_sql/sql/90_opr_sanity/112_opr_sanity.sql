SELECT * FROM (  SELECT amname, opcname, array_agg(amprocnum ORDER BY amprocnum) as procnums  FROM pg_am am JOIN pg_opclass op ON opcmethod = am.oid  LEFT JOIN pg_amproc p ON amprocfamily = opcfamily AND  amproclefttype = amprocrighttype AND amproclefttype = opcintype  GROUP BY amname, opcname, amprocfamily  ) AS t  WHERE NOT (   amname = 'btree' AND procnums @> '{1}' OR  amname = 'hash' AND procnums = '{1}' OR  amname = 'gist' AND procnums @> '{1, 2, 3, 4, 5, 6, 7}' OR  amname = 'gin' AND (procnums @> '{1, 2, 3}' AND (procnums && '{4, 6}')) OR  amname = 'spgist' AND procnums = '{1, 2, 3, 4, 5}' OR  amname = 'brin' AND procnums @> '{1, 2, 3, 4}'  );
